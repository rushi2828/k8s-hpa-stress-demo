# ğŸš€ k8s-hpa-stress-demo [CPU HPA Demo on Kubernetes]
This project demonstrates how to use the Kubernetes **Horizontal Pod Autoscaler (HPA)** to scale a CPU-intensive container (`vish/stress`) based on **CPU utilization**. It's built and tested to work with [KIND](https://kind.sigs.k8s.io/) and supports GitOps best practices.

---

## ğŸ“ Project Structure

```
k8s-hpa-stress-demo/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ validate-manifests.yaml   # GitHub Actions CI
â”œâ”€â”€ k8s/
â”‚   â”œâ”€â”€ deployment.yaml               # CPU burner deployment
â”‚   â”œâ”€â”€ hpa.yaml                      # Horizontal Pod Autoscaler config
â”‚   â”œâ”€â”€ kustomization.yaml            # Kustomize support
â”‚   â””â”€â”€ namespace.yaml                # Project namespace
â”œâ”€â”€ manifests/                        # Generated by kustomize
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## ğŸ”§ Prerequisites

- [kubectl](https://kubernetes.io/docs/tasks/tools/)
- [kind](https://kind.sigs.k8s.io/)
- Metrics Server installed in your KIND cluster  
  ğŸ‘‰ [Install Instructions](#installing-metrics-server-on-kind)

---

## ğŸš€ Deploy the HPA Demo

```
kubectl apply -f k8s/namespace.yaml
```
![image](https://github.com/user-attachments/assets/ef171140-6b30-4153-b8d1-8419da9316a7)
```
kubectl apply -f k8s/deployment.yaml
kubectl apply -f k8s/hpa.yaml
```
![image](https://github.com/user-attachments/assets/97f30b0a-cab4-46b5-80b5-e9701b599e37)


---

## ğŸ”¥ Simulating CPU Load

The container uses the \`vish/stress\` image to burn CPU using:

```
-cpus 1
```

This creates enough load to trigger scaling based on the HPA thresholds.

---

## ğŸ“ˆ Monitoring HPA

```
kubectl get hpa -n hpa-demo --watch
```
![image](https://github.com/user-attachments/assets/42aeb5df-d2e5-45f0-818a-003a74804d60)
![image](https://github.com/user-attachments/assets/3c25b7c4-8d49-4927-a400-0b2d0a39450e)

```
kubectl get pods -n hpa-demo -w
```
![image](https://github.com/user-attachments/assets/2afd6f30-fe18-42dd-a640-3f2450ca4419)
![image](https://github.com/user-attachments/assets/998c3164-ca99-41c5-a4f6-0aad356e2091)

```
kubectl describe hpa cpu-burner-hpa -n hpa-demo
```
![image](https://github.com/user-attachments/assets/867dc909-5840-42f9-a6ea-686d1eddff63)


Once load increases, the number of pods should scale from 1 up to 5.

---

## ğŸ§¼ Cleanup

```
kubectl delete ns hpa-demo
```

---

## ğŸ“Š Installing Metrics Server on KIND

The Metrics Server is not installed by default in KIND. Run:

```
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml

kubectl patch deployment metrics-server -n kube-system \
  --type=json \
  -p='[{"op": "add", "path": "/spec/template/spec/containers/0/args/-", "value": "--kubelet-insecure-tls"}]'
```
![image](https://github.com/user-attachments/assets/92326370-39f2-4684-a3bf-7249fb875f1f)

Then verify:

```
kubectl top nodes
```
![image](https://github.com/user-attachments/assets/4245b6df-fe36-48e9-b931-6b2a481f10cf)
```
kubectl top pods -n hpa-demo
```
![image](https://github.com/user-attachments/assets/0916f0dc-8f05-4b9a-b229-feb62e5dfc9f)

---

## âš™ï¸ CI/CD with GitHub Actions

A GitHub Actions workflow is included that:

- Validates all Kubernetes YAML manifests
- Runs \`kustomize build\`
- Uses [\`kubeconform\`](https://github.com/yannh/kubeconform) for strict schema validation
- Performs \`kubectl apply --dry-run=client\`

```
.github/workflows/validate-manifests.yaml
```

---

## âœ… Tech Stack

- ğŸ³ \`vish/stress\` â€” simple CPU burner container
- âš™ï¸ Kubernetes HPA (v2)
- ğŸ’¥ KIND (Kubernetes in Docker)
- ğŸ“¦ GitHub Actions
- ğŸ“ Kustomize (optional)
- ğŸ” kubeconform (validation)

---
